name: Post Remaining Days of Ummath

on:
  schedule:
    - cron: '0 9 * * *' 
  workflow_dispatch:  

jobs:
  post-ummath:
    runs-on: ubuntu-latest

    steps:
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9' 

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install tweepy requests_oauthlib

      - name: Calculate Remaining Days and Years
        id: calculate_days
        run: |
          current_date=$(date +%Y-%m-%d)
          end_date="2080-09-04"

          current_seconds=$(date -d "$current_date" +%s)
          end_seconds=$(date -d "$end_date" +%s)

          remaining_days=$(( (end_seconds - current_seconds) / 86400 ))

          remaining_years=$(( remaining_days / 365 ))
          remaining_days=$(( remaining_days % 365 ))

          echo "remaining_years=$remaining_years" >> $GITHUB_ENV
          echo "remaining_days=$remaining_days" >> $GITHUB_ENV

      - name: Post to Twitter
        run: |
          python /home/runner/work/Remaining-time-of-ummath-auto-tweet/.github/workflows/.github/workflows/tweet.py

        env:
          TWITTER_CLIENT_ID: ${{ secrets.TWITTER_CLIENT_ID }}
          TWITTER_CLIENT_SECRET: ${{ secrets.TWITTER_CLIENT_SECRET }}
